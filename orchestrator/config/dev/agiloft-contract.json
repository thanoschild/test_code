
{
    "dag_config": {
        "dag_id": "legal_analytics-contract",
        "schedule_interval": null,
        "sla_in_minutes": 180,
        "email": ["sherin@gmail.com"]
    },
    "task_config": {
        "airflow_variable_id_for_impersonation_chain": "legal-analytics-impersonation-chain",
        "data_project_id": "smart-pr",
        "tasks": [
            {
                "task_name": "fetch-from-source-contract",
                "task_type": "EXECUTION",
                "template_reference": "LEGAL_ANALYTICS_CF",
                "config": {
                    "table": "contract",
                    "gcs_path": "gs://legal-analytics-data/ingestion/contract",
                    "client_id": "ah91bh709ldright1",
                    "secret_key": "legal_analytics-dev-secret",
                    "columns": "contract_id, company_id, contract_name, contract_type, contract_value, start_date, end_date, contract_status, renewal_required, created_timestamp, last_updated_timestamp",
                    "api_endpoint": "https://mycompany.com/legal_analytics/tables/contract"
                },
                "downstream_tasks": ["gcs2bq-legal_analytics-contract"]
            },
            {
                "task_name": "gcs2bq-legal_analytics-contract",
                "task_type": "EXECUTION",
                "template_reference": "GCS2BQ",
                "config": {
                    "bucket": "legal-analytics-data",
                    "source_objects": [
                        "ingestion/contract/*.json"
                    ],
                    "schema_object_bucket": "legal-analytics-configs",
                    "schema_object": "schemas/contract.json",
                    "destination_project_dataset_table": "smart-pr.legal_analytics_stg.contract"
                },
                "downstream_tasks": ["stg-to-raw-legal_analytics-contract"]
            },
            {
                "task_name": "stg-to-raw-legal_analytics-contract",
                "task_type": "MERGE",
                "template_reference": "RAW_DL_UPDATE",
                "config": {
                    "stg_table": "smart-pr.legal_analytics_stg.contract",
                    "dl_table": "smart-pr.legal_analytics_dl.contract",
                    "raw_table": "smart-pr.legal_analytics_raw.contract",
                    "primary_key_columns": "clause_id"
                }
            }
        ]
    },
    "template_config": {
        "merge_templates": [
            {
                "template_id": "RAW_DL_UPDATE",
                "merge_type": "MERGE_UPDATE",
                "config": {
                    "truncate_stg_table": "False"
                }
            }
        ],

        "execution_templates": [
            {
                "template_id": "LEGAL_ANALYTICS_CF",
                "execution_type": "AUTHENTICATED_CLOUD_FUNCTION",
                "config": {
                    "method": "POST",
                    "url": "https://us-west1-smart-pr.cloudfunction.net/legal_analytics-ingestion",
                    "headers": {
                        "Content-Type": "application/json"
                    }
                }
            }
        ]
    }
}